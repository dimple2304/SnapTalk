<style>
  /* Heart pop animation */
  @keyframes pop {
    0% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.4);
    }

    100% {
      transform: scale(1);
    }
  }

  /* Burst dots flying outward */
  @keyframes burst {
    0% {
      transform: scale(0.2);
      opacity: 1;
    }

    80% {
      opacity: 1;
    }

    100% {
      transform: scale(1) translate(var(--x), var(--y));
      opacity: 0;
    }
  }

  .heart-pop {
    animation: pop 0.4s ease-in-out;
  }

  .burst-circle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 8px;
    height: 8px;
    background-color: #ec4899;
    /* Tailwind pink-500 */
    border-radius: 50%;
    transform-origin: center;
    animation: burst 0.6s ease-out forwards;
  }
</style>
<% if(posts && posts.length>0) { %>
<% posts.forEach(function (element) { %>
<div class="bg-white p-6 rounded-2xl shadow-sm">
  <div class="flex space-x-4">
    <img src="<%= element.profile.profilepic.url %>" alt="Avatar" class="rounded-full h-12 w-12">
    <div class="w-full">
      <div class="flex justify-between items-center">
        <div>
          <span class="font-bold text-gray-900"><%= element.user.name %></span>
          <span class="text-gray-400 ml-2 text-sm">@<%= element.user.username %></span>
          <span class="post-time text-gray-400 ml-2 text-sm"><%= element.createdAt %></span>
        </div>
        <button class="text-gray-400 hover:text-gray-600">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
          </svg>
        </button>
      </div>
      <p class="mt-2 text-gray-700"><%= element.thought %></p>
      <div class="postdynamicimg">
        <% if (element.media.url) { %>
        <img src="<%= element.media.url %>" class="w-45 max-h-[350px] h-45 mt-4 object-cover" alt="Post image">
        <% } %>
        <!-- <img src="https://placehold.co/500x280/1a202c/ffffff?text=UI+Palette" class="mt-4 rounded-xl w-full" alt="UI Palette Image"> -->
      </div>
      <div class="flex justify-start items-center mt-5 space-x-8 text-gray-500">
        <div class="like-button relative flex items-center space-x-2 <%= element.likes.some(el => el.user.toString() === user._id.toString())?"text-pink-500" : "hover:text-pink-500" %> cursor-pointer" data-userIdOfFeed="<%= user._id %>" data-postId="<%= element._id %>">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
          </svg>
          <div class="likes-count text-black"><%= element.likes.length>0 ? element.likes.length : "" %></div>
        </div>
        <div class="flex items-center space-x-2 hover:text-blue-500 cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd" />
          </svg><span>31</span>
        </div>
        <div class="flex items-center space-x-2 hover:text-green-500 cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
          </svg><span>15</span>
        </div>
      </div>
    </div>
  </div>
</div>
<% }) %>
<% } else { %>
<p class="text-gray-500 text-center mt-10">No posts yet.</p>
<% } %>


<script>
  function getPostTime(dateString) {

    const postDate = new Date(dateString);
    const nowDate = new Date();
    const diff = Math.floor(nowDate - postDate) / 1000;

    if (diff < 60) return "Just now";
    if (diff < 3600) return Math.floor(diff / 60) + "m ago";
    if (diff < 86400) return Math.floor(diff / 3600) + "h ago";
    if (diff < 604800) return Math.floor(diff / 86400) + "d ago";

    return postDate.toLocaleDateString();
  }

  document.querySelectorAll(".post-time").forEach(element => {
    element.innerHTML = getPostTime(element.innerHTML);
  });

   document.querySelectorAll(".like-button").forEach(button => {
    button.addEventListener("click", function () {
      const svg = this.querySelector("svg");

      // Toggle color (pink â†” gray)
      const isLiked = this.classList.toggle("text-pink-500");
      this.classList.toggle("text-gray-500", !isLiked);

      // Only animate when liking
      if (!isLiked) return;

      // Heart pop
      svg.classList.add("heart-pop");
      setTimeout(() => svg.classList.remove("heart-pop"), 400);

      // Burst dots
      for (let i = 0; i < 6; i++) {
        const circle = document.createElement("span");
        circle.classList.add("burst-circle");

        const angle = (Math.PI * 2 * i) / 6;
        const distance = 35;
        circle.style.setProperty("--x", `${Math.cos(angle) * distance}px`);
        circle.style.setProperty("--y", `${Math.sin(angle) * distance}px`);

        this.appendChild(circle);
        setTimeout(() => circle.remove(), 1200);
      }
    });
  });
</script>